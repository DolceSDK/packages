pkgname=openssl
pkgver=1.0.2
pkgrel=1
url="https://github.com/d3m3vilurr/vita-openssl"
source=("git://github.com/d3m3vilurr/vita-openssl.git#branch=vita-1_0_2s" "openssl.patch")
sha256sums=('SKIP' 'SKIP')

prepare() {
  cd vita-openssl
  patch --strip=1 --input="${srcdir}/openssl.patch"
}

build() {
  cd vita-openssl
  ./Configure no-threads --prefix=$DOLCESDK/arm-dolce-eabi/ vita-cross
  make -j$(nproc) depend
  make -j$(nproc)
}

package () {
  cd vita-openssl
  printf '#!/bin/bash\nmkdir -p $@\n' > util/mkdir-p.pl
  make INSTALL_PREFIX=$pkgdir install
  rm -rf $pkgdir/$prefix/ssl/man # remove useless man pages
}
